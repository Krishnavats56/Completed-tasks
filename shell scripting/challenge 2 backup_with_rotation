#!/bin/bash

: <<'help'
This script is written for task completion.
It takes a directory path, creates a timestamped backup, and retains only the last 3 backups.
help

# First argument is source
src="$1"

# Create timestamp
timestamp=$(date '+%y-%m-%d-%H-%M-%S')

# Setup backup path
backup_parent="./backup"
mkdir -p "$backup_parent"
backup_dir="$backup_parent/backup_$timestamp"
mkdir "$backup_dir"

# Copy source folder into backup
cp -r "$src" "$backup_dir"

echo "backup successfull at : $backup_dir"

# --- Backup rotation: keep only last 3 ---

# Get list of backups (newest first)
backups=( $(ls -dt "$backup_parent"/backup_*) )

# If more than 3 backups, delete oldest ones
if [ "${#backups[@]}" -gt 3 ]; then
    for (( i=3; i<${#backups[@]}; i++ )); do
        echo "removing old backup : ${backups[$i]}"
        rm -rf "${backups[$i]}"
    done
fi
